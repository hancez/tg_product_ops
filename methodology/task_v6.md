# Telegram Bot 用户行为分析与标注任务 (v6 - 增加输出Token + 置信度评分)

## 任务目标

分析用户与 Telegram Bot (ShellAgent) 的交互数据，判断用户的使用情况、流失阶段和详细原因。

## 输入数据

你将收到一个用户的所有交互数据，数据可能包含以下文件：

1. **tg2app_bot_messages_v2_filtered.csv** - 用户与 ShellAgent bot 的消息交互数据
   - 字段：user_id, tg_bot_id, src, data, created_date
   - src: "send" (用户发送) 或 "reply" (bot回复)
   - data: JSON格式的消息详情

2. **tg2app_bot_running_messages_v2_filtered.csv** - 用户创建的bot运行时交互数据
   - 字段：user_id, bot_id, src, data, reply_id, created_date
   - src: "send" (用户发送) 或 "reply" (bot回复)
   - data: JSON格式的消息详情

---

## 分析维度

### 1. shellagent对话轮次（剔除start）

**定义**: 统计用户在 **Messages 表**中与 ShellAgent 的**用户发送消息次数**（src="send"），但**不包括** /start 命令。

**⚠️ 常见错误及避免方法**:
- ❌ 错误：只数了1-2条消息就标记为"1-5"，实际有7-8条 → 应标记为">5"
- ✅ 正确：**仔细逐行统计 Messages 表中 src="send" 的所有记录**
- ✅ 正确：使用 Ctrl+F 搜索 `"src": "send"` 确保不遗漏

**精确计数步骤**:
1. 打开 Messages 表数据
2. 逐行检查，每遇到一条 src="send" 的记录，计数 +1
3. 排除所有 /start 命令（包括 "/start"、"/start reddit"、"/start XXX" 等）
4. **重要**：不要遗漏任何 src="send" 的记录，即使内容很短或看起来不重要
5. 最后根据总数确定分类

**分类标准**（严格执行）:
- `0`: 0次有效对话（只有 /start 或无交互）
- `1`: **恰好1次**对话
- `1-5`: **2到5次**对话（包含边界值2和5）
- `>5`: **6次及以上**对话（注意：5次仍然是"1-5"，6次才是">5"）

**判断示例**:
```
示例 1: 用户发送了 "/start" + "create bot" + "yes" + "thanks" = 3条
→ 输出: 1-5

示例 2: 用户发送了 "/start reddit" + 6条其他消息 = 6条
→ 输出: >5

示例 3: 用户发送了 8条消息（不含 /start）
→ 输出: >5  （不是 1-5！）

示例 4: 用户只发送了 "/start"
→ 输出: 0
```

---

### 2. 成功生成bot数

**定义**: 用户成功创建的 bot 数量。

**判断标准** (按优先级，**逐条检查**):
1. ✅ Messages 表中出现 "Done!" 或 "完成" 的 bot 回复
2. ✅ 出现 "Your bot @xxx_bot is ready" 或 "bot创建完成"
3. ✅ Running Messages 表中存在**不同的** bot_id 记录（同一个 bot_id 只算1个）
4. ❌ 如果只是 bot 生成**过程中**的消息，但没有最终成功标志 → 不算

**⚠️ 常见错误**:
- ❌ 错误：用户尝试创建了3次，但只有2次成功 → 应输出 2（不是3）
- ❌ 错误：Running Messages 中同一个 bot_id 出现多次 → 只算1个bot
- ✅ 正确：严格查找"Done"、"ready"、"完成"等成功标志

**输出格式** (非常重要):
- **必须输出纯整数**：0, 1, 2, 3, 4...
- **绝对不要输出浮点数**：1.0, 2.0, 3.0 是错误的
- **格式示例**：
  ```json
  "成功生成bot数": 2   ✅ 正确
  "成功生成bot数": 2.0  ❌ 错误
  ```

**判断流程**:
```
1. 检查 Messages 表，搜索 "Done"、"ready"、"完成" → 计数
2. 检查 Running Messages 表，统计唯一的 bot_id 数量 → 计数
3. 取两者的最大值（以确保不遗漏）
4. 输出整数（不带小数点）
```

---

### 3. bot对话轮次

**定义**: 用户与自己创建的 bot 的交互轮次。

**数据来源**: **只且仅统计 Running Messages 表**

**⚠️ 这是错误率最高的字段 - 请特别注意！**

**常见严重错误**:
1. ❌ 错误：统计了 Messages 表的数据 → **大错特错！只能看 Running Messages**
2. ❌ 错误：用户发送了 /start + 3条消息，标记为 0 → 应该是 1-5
3. ❌ 错误：Running Messages 中有10条记录，标记为 1-5 → 应该仔细数 src="send" 的数量
4. ❌ 错误：看到 Running Messages 为空就输出 "空" → 应该输出 0

**精确计数步骤**（务必严格执行）:
1. **忽略 Messages 表**，只看 Running Messages 表
2. 在 Running Messages 表中，逐行检查 src="send" 的记录
3. **排除 /start 命令**
4. 计数所有其他 src="send" 的记录
5. 根据总数确定分类

**分类标准**:
- `0`: Running Messages 表为空，或只有 /start，或只有 bot 回复
- `1`: **恰好1次**有效对话
- `1-5`: **2到5次**有效对话
- `>5`: **6次及以上**对话

**输出规则**:
- ✅ 如果 Running Messages 表不存在或为空 → 输出 `0`（不是"空"）
- ✅ 如果表存在但只有 bot 的回复，没有用户发送 → 输出 `0`
- ✅ 如果用户只发送了 /start → 输出 `0`
- ❌ **不要输出"空"** - 除非数据完全缺失且无法判断

**典型错误案例分析**:
```
❌ 错误案例 1: 用户 38991110
   Running Messages: 用户发送了 /start + /joke + /help + /veg + /subscribe + "Test Bot" = 5条
   错误输出: 0 或 空
   正确输出: 1-5

❌ 错误案例 2: 用户 38997024
   Running Messages: 用户发送了 "Londres" + "Brasil" + "Sexo" + 其他消息 = 8条以上
   错误输出: 1-5
   正确输出: >5

✅ 正确案例: 用户 38990226
   Running Messages: 表为空
   正确输出: 0
```

---

### 4. 使用情况

**判断流程** (严格按顺序，不要跳步):

#### 第1步：检查不当内容尝试
- 如果用户尝试生成成人/色情内容被拒绝 → `成人内容生成失败`
- 如果用户尝试生成盗版/侵权内容被拒绝 → `盗版内容生成失败`

#### 第2步：检查生成意图
- 如果用户只是闲聊、问候、无关话题，没有明确创建 bot 的请求 → `无生成bot倾向的闲聊`

#### 第3步：检查 bot 是否生成成功
- 如果"成功生成bot数" = 0 → 返回上述分类，不继续

#### 第4步：检查是否使用了生成的 bot **（关键区分点）**

**⚠️ 这里是高错误率区域 - 请仔细区分！**

**情况 A: 完全未使用**
- 条件：Running Messages 表为空 **或** "bot对话轮次" = 0
- 输出：`bot生成成功但未使用`

**情况 B: 仅简单体验**
- 条件：**同时满足以下所有条件**
  1. Running Messages 表存在且有记录
  2. "bot对话轮次" ≥ 1（用户确实发送了消息）
  3. 用户只发送了 1-3 条测试性消息（如 /start、/help、"hi"、"test"）
  4. **没有使用 bot 的核心功能**（如没有实际生成内容、没有完成任务流程）
  5. 没有明显的错误或问题
- 输出：`bot功能正常但用户仅简单体验`

**情况 C: 不会使用**
- 条件：
  1. 用户尝试使用 bot 但操作错误
  2. bot 提示用户使用正确命令，但用户不理解
  3. 用户发送了错误的指令或内容
- 输出：`bot功能正常但用户不会用`

**典型错误案例**:
```
❌ 错误: 用户 38991110
   数据: Running Messages 有多条记录，用户测试了多个功能
   错误判断: bot生成成功但未使用
   正确判断: bot功能不符合预期 或 bot功能正常但用户仅简单体验

   分析: 如果 Running Messages 有记录，就不能是"未使用"！

❌ 错误: 用户 39083075
   数据: Running Messages 中用户发送了 /start 两次
   错误判断: 无生成bot倾向的闲聊
   正确判断: bot功能正常但用户仅简单体验

   分析: 如果 bot 已经生成并且用户启动了它，就不是"闲聊"！
```

#### 第5步：分析使用过程中的问题
- 检查是否有错误消息、异常、bug → `bot功能有bug`
- 检查用户是否抱怨功能不符预期 → `bot功能不符合预期`
- 如果用户深度使用且无问题 → `使用顺畅`

#### 第6步：特殊情况
- 其他无法分类 → `其他`

**必须从以下列表选择**:
- 使用顺畅
- bot功能不符合预期
- bot功能有bug
- bot功能正常但用户不会用
- bot功能正常但用户仅简单体验
- bot生成成功但未使用
- 成人内容生成失败
- 盗版内容生成失败
- 无生成bot倾向的闲聊
- 其他

---

### 5. 流失阶段

**定义**: 用户在整个使用流程中的哪个阶段停止使用或流失。

**判断逻辑**（按顺序检查，找到第一个匹配的就停止）:

1. **使用顺畅（未流失）**
   - 条件：使用情况 = "使用顺畅"
   - 输出：`使用顺畅`

2. **生成阶段流失**
   - 条件：以下任一条件满足
     - 使用情况 = "成人内容生成失败"
     - 使用情况 = "盗版内容生成失败"
     - 使用情况 = "无生成bot倾向的闲聊"
     - "成功生成bot数" = 0
   - 输出：`生成阶段`

3. **已生成未使用流失**
   - 条件：以下**所有**条件满足
     - "成功生成bot数" ≥ 1
     - "bot对话轮次" = 0
     - 使用情况 = "bot生成成功但未使用"
   - 输出：`已生成未使用`

4. **使用阶段流失**
   - 条件：以下**所有**条件满足
     - "成功生成bot数" ≥ 1
     - "bot对话轮次" ≥ 1
     - 使用情况 ≠ "使用顺畅"
   - 输出：`使用阶段`

5. **无法判断**
   - 输出：`空`

**⚠️ 常见错误**:
```
❌ 错误: 用户成功生成了 bot，Running Messages 有记录，但标记为"已生成未使用"
   正确: 应该是"使用阶段"

❌ 错误: 用户完全未生成 bot，但标记为"使用阶段"
   正确: 应该是"生成阶段"

❌ 错误: 使用情况是"使用顺畅"，但流失阶段标记为"使用阶段"
   正确: 应该是"使用顺畅"（逻辑一致）
```

**必须从以下列表选择**:
- 生成阶段
- 已生成未使用
- 使用阶段
- 使用顺畅
- 空

**逻辑一致性检查**（自检）:
- ✅ 使用情况="使用顺畅" → 流失阶段必须="使用顺畅"
- ✅ 成功生成bot数=0 → 流失阶段不能是"已生成未使用"或"使用阶段"
- ✅ bot对话轮次=0 且 成功生成bot数≥1 → 流失阶段应该是"已生成未使用"
- ✅ bot对话轮次≥1 且 成功生成bot数≥1 → 流失阶段应该是"使用阶段"或"使用顺畅"

---

### 6. 详细原因

**要求**: 简洁描述用户的行为和可能的流失原因（**150-300字**）。

**必须包含的内容**:
1. ✅ 用户的主要行为（想创建什么bot、尝试了什么）
2. ✅ bot是否成功生成，生成了几个
3. ✅ 用户是否使用了bot，使用了多少次，做了什么
4. ✅ 遇到了什么问题（如果有）
5. ✅ 可能的流失原因分析

**写作要求**:
- 使用客观、陈述性语言
- 基于数据事实，不要过度推测
- **长度控制在 150-300 字**（不要过长或过短）

---

---

### 7. 置信度评分（新增）

**定义**: 对本次标注质量的自我评估，1-10分。

**评分标准**:

**10分** - 完美置信度：
- ✅ 数据完整清晰，所有关键信息都有
- ✅ 判断依据充分，没有任何歧义
- ✅ 所有字段都有明确的证据支持
- ✅ 逻辑完全一致，没有矛盾

**9分** - 极高置信度：
- ✅ 数据清晰，判断依据充分
- ✅ 只有极少量次要信息缺失
- ✅ 核心字段判断非常确定

**8分** - 高置信度：
- ✅ 数据基本清晰
- ✅ 大部分字段判断明确
- ⚠️ 个别字段可能需要轻微推断

**7分** - 中等偏高置信度：
- ⚠️ 数据有部分不完整
- ⚠️ 某些字段需要合理推断
- ✅ 但整体逻辑可靠

**6分** - 中等置信度：
- ⚠️ 数据不完整，缺少关键信息
- ⚠️ 多个字段需要推断
- ⚠️ 可能存在轻微歧义

**5分** - 中等偏低置信度：
- ⚠️ 数据明显不完整
- ⚠️ 需要较多推断和假设
- ⚠️ 存在明显歧义

**4分及以下** - 低置信度：
- ❌ 数据严重不完整或矛盾
- ❌ 大量字段基于猜测
- ❌ 判断依据不足

**降低置信度的因素**（每项 -1 到 -2 分）:
- 数据记录数量极少（<3条）
- Messages 或 Running Messages 表为空
- 关键操作结果不明确（不确定bot是否生成成功）
- 用户行为突然中断，没有明确结局
- 存在矛盾或异常数据
- "使用情况"字段难以明确分类（边界模糊）

**提升置信度的因素**（每项 +0.5 到 +1 分）:
- 数据完整，时间线清晰
- 有明确的成功/失败标志（Done、Error等）
- 用户意图明显
- 所有字段都有明确证据支持
- 逻辑完全一致

**置信度说明**（新增字段）:
- 用 20-50 字简要说明为什么给这个置信度分数
- 例如："数据完整，用户行为清晰，所有字段都有明确证据"
- 例如："缺少Running Messages数据，bot对话轮次无法准确判断"

---

## 输出格式

输出一个 JSON 对象，**严格遵守以下格式**：

```json
{
  "userid": "用户ID（字符串）",
  "置信度": 7,
  "置信度说明": "简要说明（20-50字）",
  "shellagent对话轮次(剔除start)": "0 | 1 | 1-5 | >5",
  "成功生成bot数": 整数（不要用浮点数，例如：2 而不是 2.0）,
  "bot对话轮次": "0 | 1 | 1-5 | >5",
  "使用情况": "使用情况分类（必须从指定列表选择）",
  "流失阶段": "流失阶段分类（必须从指定列表选择）",
  "详细原因": "详细描述（150-300字）"
}
```

**注意**:
- "置信度" 必须是整数（1-10）
- "置信度说明" 必须提供（20-50字）
- 置信度字段必须放在最前面（userid 之后）

---

## 重要提示和质量检查清单

### ✅ 提交前自检（必须全部通过）:

1. **格式检查**:
   - [ ] "成功生成bot数" 是整数（如 2），不是浮点数（如 2.0）
   - [ ] 所有分类字段的值都来自指定列表
   - [ ] JSON 格式正确，没有多余的文字

2. **计数准确性**:
   - [ ] shellagent对话轮次：仔细统计了 Messages 表中 src="send" 的数量
   - [ ] bot对话轮次：**只**统计了 Running Messages 表（不是 Messages 表）
   - [ ] 成功生成bot数：查找了明确的成功标志

3. **逻辑一致性**:
   - [ ] 如果 bot对话轮次 > 0，使用情况不能是"bot生成成功但未使用"
   - [ ] 如果 成功生成bot数 = 0，流失阶段不能是"已生成未使用"或"使用阶段"
   - [ ] 如果 使用情况 = "使用顺畅"，流失阶段必须是"使用顺畅"

4. **常见陷阱避免**:
   - [ ] 没有混淆 Messages 表和 Running Messages 表
   - [ ] 没有把 1-5 和 >5 的边界搞错（5 是 1-5，6 才是 >5）
   - [ ] 没有输出"空"（除非真的无法判断）
   - [ ] 详细原因的长度在 150-300 字之间

---

## 最后提醒

**这是第3版优化的提示词，针对 v2 中常见的错误进行了重点强化：**
1. 🎯 重点强化了对话轮次的计数方法（v2 错误率最高）
2. 🎯 明确了"未使用"vs"仅简单体验"的区分标准
3. 🎯 增加了大量错误案例和正确示例
4. 🎯 添加了提交前自检清单

**请严格按照上述规则进行分析和标注，确保准确率达到 90% 以上。**

请直接输出JSON，不要有其他解释文字或markdown代码块标记。
